# –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å "–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞"

## UseCase

- –º–µ–Ω–µ–¥–∂–µ—Ä –±–∞–Ω–∫–∞ –ê–Ω–Ω–∞, –æ—Ç–∫—Ä—ã–ª–∞ –∫–ª–∏–µ–Ω—Ç—É –ò–≤–∞–Ω—É –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–µ–∫—É—â–∏–π —Å—á—ë—Ç, —á—Ç–æ–±—ã –æ–Ω –º–æ–≥ —Ö—Ä–∞–Ω–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞.

## üîë –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

1. **–î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å (`Account`, `Transaction`)**

    * `Account` –æ—Ç—Ä–∞–∂–∞–µ—Ç —Å—É—â–Ω–æ—Å—Ç—å —Å—á—ë—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º, –≤–∞–ª—é—Ç–æ–π, —Å—Ç–∞–≤–∫–æ–π, –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.
    * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–∏–ø—ã —Å—á—ë—Ç–æ–≤ (`Deposit`, `Checking`, `Credit`).
    * –ï—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ `IsFrozen` –∏ soft-delete —á–µ—Ä–µ–∑ `ClosedAt`.
    * `Transaction` —Ö—Ä–∞–Ω–∏—Ç –¥–≤–∏–∂–µ–Ω–∏—è –ø–æ —Å—á—ë—Ç—É, –≤–∫–ª—é—á–∞—è `CounterPartyAccountId` –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤.

2. **DTO + –í–∞–ª–∏–¥–∞—Ü–∏—è (`CreateAccountDto`, `CreateAccountValidator`)**

    * –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ DTO –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π ‚Äî üëç.
    * FluentValidation –≥—Ä–∞–º–æ—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞:

        * –¥–µ–ø–æ–∑–∏—Ç/—Ä–∞—Å—á—ë—Ç–Ω—ã–π: –±–∞–ª–∞–Ω—Å ‚â• 0
        * –∫—Ä–µ–¥–∏—Ç–Ω—ã–π: –±–∞–ª–∞–Ω—Å ‚â§ 0
        * –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞/–∫—Ä–µ–¥–∏—Ç–∞
        * –∫–æ–¥ –≤–∞–ª—é—Ç—ã ISO 4217.

3. **CQRS + Mediator**

    * `CreateAccountRequest` ‚Üí `CreateAccountHandler`.
    * Handler —Å–æ–∑–¥–∞—ë—Ç –∞–∫–∫–∞—É–Ω—Ç, –ø–∏—à–µ—Ç —Å–æ–±—ã—Ç–∏–µ `AccountOpened` –≤ outbox, —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

4. **–°–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å**

    * `AccountOpened` –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Outbox.
    * `CreateAccountProducer` –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ –±–∞–∑—ã –∏ —à–ª—ë—Ç –≤ RabbitMQ (—Å retry –∏ jitter).
    * `CreateAccountConsumer` —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ –ø–∏—à–µ—Ç –≤ Inbox –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.
    * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Outbox / Inbox –ø–∞—Ç—Ç–µ—Ä–Ω + EventEnvelope (correlation, causation, source)** ‚Äî —ç—Ç–æ —É–∂–µ —É—Ä–æ–≤–µ–Ω—å —Å–µ—Ä—å—ë–∑–Ω–æ–π **event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** üëç.

5. **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**

    * EF Core (`ModuleBankAppContext`) —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏ (HASH –ø–æ `OwnerId`), row versioning —á–µ—Ä–µ–∑ `xmin`.
    * `CorrelationIdMiddleware` –¥–ª—è —Å–∫–≤–æ–∑–Ω–æ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏.
    * EventBus —Å RabbitMQ.

6. **API Endpoint**

    * `POST /account` —Å–æ–∑–¥–∞—ë—Ç —Å—á—ë—Ç.
    * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `201 Created` + DTO.
    * –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç `OwnerId` –∫ Claims.

    
üöÄ –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å

- –º–µ–Ω–µ–¥–∂–µ—Ä –±–∞–Ω–∫–∞ –ê–Ω–Ω–∞, –æ—Ç–∫—Ä—ã–ª–∞ –∫–ª–∏–µ–Ω—Ç—É –ò–≤–∞–Ω—É —Å—Ä–æ—á–Ω—ã–π –≤–∫–ª–∞–¥ ¬´–ù–∞–¥—ë–∂–Ω—ã–π‚Äë6¬ª –ø–æ–¥ 3% –≥–æ–¥–æ–≤—ã—Ö, —á—Ç–æ–±—ã –æ–Ω —Å–º–æ–≥ –Ω–∞–∫–æ–ø–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞.
- –∫–∞—Å—Å–∏—Ä –±–∞–Ω–∫–∞ –ê–ª–µ–∫—Å–µ–π, –ø–æ–ø–æ–ª–Ω–∏–ª —Ç–µ–∫—É—â–∏–π —Å—á—ë—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ò–≤–∞–Ω–∞ –Ω–∞ 1000 —Ä—É–±–ª–µ–π –Ω–∞–ª–∏—á–Ω—ã–º–∏.
- –∫–ª–∏–µ–Ω—Ç –±–∞–Ω–∫–∞ –ò–≤–∞–Ω, –ø–µ—Ä–µ–≤—ë–ª 200 —Ä—É–±–ª–µ–π —Å–æ —Å–≤–æ–µ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ —Å—á—ë—Ç–∞ –Ω–∞ –≤–∫–ª–∞–¥ ¬´–ù–∞–¥—ë–∂–Ω—ã–π‚Äë6¬ª, —á—Ç–æ–±—ã –ø–æ–ø–æ–ª–Ω–∏—Ç—å –≤–∫–ª–∞–¥.

![usecase.drawio.png](images/usecase.drawio.png)

# –ó–∞–ø—É—Å–∫ –≤ docker

```
docker-compose up --build
```
**–ó–∞–º–µ—á–∞–Ω–∏–µ**: –∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ `Keycloak` –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è,
—Ç.–∫. –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

# Swagger

```
http://localhost/swagger
```

# –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

POST /auth/login - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

```json
{
  "username": "user1",
  "password": "123"
}
```
